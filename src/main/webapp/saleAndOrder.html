<!DOCTYPE html>
<html class="x-admin-sm">
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="/css/font.css">
        <link rel="stylesheet" href="/css/xadmin.css">
        <link rel="stylesheet" href="module/soulTable/soulTable.css">
        <script src="/js/jquery.min.js"></script>
        <script src="/lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="/js/xadmin.js"></script>
    </head>
    <style>
        .layui-table-tool{
            border-bottom: 1px solid #aaa;
        }
    </style>

    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <div class="layui-fluid" id="v1">
            <div class="layui-row layui-col-space15">

                <div class="layui-col-md12">

                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <div class="layui-collapse" lay-filter="test">
                                <div class="layui-colla-item">
                                    <h2 class="layui-colla-title">计划订单添加<i class="layui-icon layui-colla-icon"></i></h2>
                                    <div class="layui-colla-content">

                                        <form class="layui-form" >

                                            <div class="layui-form-item">
                                                <label class="layui-form-label">备注</label>
                                                   <div class="layui-input-block">
                                                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
                                                </div>
                                            </div>

                                            <div class="layui-form-item">
                                                <label class="layui-form-label">支付方式</label>
                                                <div class="layui-input-inline">
                                                    <select name="pay">
                                                        <option value="支付宝" selected="">支付宝</option>
                                                        <option value="微信" >微信</option>
                                                        <option value="银联">银联</option>
                                                        <option value="随行付">随行付</option>
                                                        <option value="银盛支付">银盛支付</option>
                                                    </select>
                                                </div>
                                            </div>


                                            <div class="layui-form-item">
                                                <label class="layui-form-label">收货人</label>
                                                <div>
                                                    <div id="kehuid"></div>
                                                </div>
                                                </div>


                                            <div class="layui-form-item">

                                                <div class="layui-form-item">
                                                    <div class="layui-input-block">
                                                    <button type="button" class="layui-btn layui-btn-normal" onclick="openAdd2()">
                                                        <i class="layui-icon"></i>添加计划订单商品</button>
                                                    </div>
                                                </div>

                                                <div class="layui-form-item">
                                                    <table id="addgoods" class="layui-table" lay-filter="addgoods"></table>
                                                </div>

                                            </div>

                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                                                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <form class="layui-form layui-col-space5">
                                    <div class="layui-inline layui-show-xs-block">
                                        <input type="text" name="createTime" style="width: 180px;"
                                               class="layui-input" placeholder="下单时间"></div>
                                    <div class="layui-inline layui-show-xs-block">
                                <div class="layui-inline layui-show-xs-block">
                                    <input type="text" name="ordernumber" placeholder="请输入订单号"  autocomplete="off" class="layui-input"></div>
                                    <div class="layui-inline layui-show-xs-block">
                                            <div id="kehuid2"></div>
                                    </div>
                                <div class="layui-inline layui-show-xs-block">
                                    <button class="layui-btn" lay-submit="" lay-filter="search">
                                        <i class="layui-icon">&#xe615;</i></button>
                                </div>
                                </div>
                            </form>
                        </div>
                        <div class="layui-card-body ">
<!--                            <table class="layui-table" lay-data="{url:'saleandorder/selectAll',page:true,size:'sm',toolbar: '#toolbarDemo',id:'test',done:doneTest}" lay-filter="test">-->
<!--                               -->
<!--                                <thead>-->
<!--                                <tr>-->
<!--                                    <th lay-data="{type:'checkbox'}">ID</th>-->
<!--                                    <th lay-data="{field:'ordernumber', width:150, sort: true}">计划订单编号</th>-->
<!--                                    <th lay-data="{field:'ordernumber2', width:150, sort: true}">关联订单编号</th>-->
<!--                                    <th lay-data="{field:'customername'}">收货人</th>-->
<!--                                    <th lay-data="{field:'stotal',  minWidth: 80,templet:'#RMB'}">总金额</th>-->
<!--                                    <th lay-data="{field:'status', minWidth: 80,templet: '#orderTemp'}">订单状态</th>-->
<!--                                    <th lay-data="{field:'sdate', sort: true,templet: '#timeTemp2'}">下单时间</th>-->
<!--                                    <th lay-data="{field:'rdate', sort: true,templet: '#timeTemp'}">交货日期</th>-->
<!--                                    <th lay-data="{field:'author', sort: true}">制单人</th>-->
<!--                                    <th lay-data="{field:'inspect', sort: true}">审核人</th>-->
<!--                                    <th lay-data="{field:'remarks', sort: true, edit: 'text'}">备注</th>-->
<!--                                </thead>-->
<!--                            </table>-->
                            <table id="soultable" lay-event="" lay-filter="soultable"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-fluid" id="xx">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">

                        </div>

                            <table class="layui-table layui-form " lay-filter="xtable" id="xtable" >

                            </table>

                        </div>
                        <div class="layui-card-body ">
                            <fieldset id="page1" class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                                <legend>选择一条数据...</legend>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </body>
    <script src="/js/vue-2.4.0.js"></script>
    <script src="/js/axios.min.js"></script>
    <script src="/js/qs.min.js"></script>
    <script type="text/html" id="orderTemp">
        {{#  if(d.status === '未出库'){ }}
        <span style="color: #eb7cab;">{{ d.status }}</span>
        {{#  } else if(d.status === '已出库'){ }}
        <span style="color: #77bf77;">{{ d.status }}</span>
        {{#  } else { }}
        {{ d.status }}
        {{#  } }}
    </script>
    <script type="text/html" id="timeTemp">
        {{layui.util.toDateString(d.rdate, 'yyyy-MM-dd HH:mm:ss')}}
    </script>
    <script type="text/html" id="timeTemp2">
        {{layui.util.toDateString(d.sdate, 'yyyy-MM-dd HH:mm:ss')}}
    </script>
    <script type="text/html" id="RMB">
        {{d.stotal+'￥'}}
    </script>
    <script type="text/html" id="warehouse">
        {{#  if(d.warehouses==null||d.warehouses.length==0){ }}
        {{'仓库存不存在'}}
        {{#  } else { }}
        {{d.warehouses[0].wname}}
        {{#  } }}
    </script>
    <script type="text/html"id="producttype">
        {{d.producttypes[0].producttypename}}
    </script>
    <script type="text/html" id="RMB1">
        {{d.pbprice+'￥'}}
    </script>
    <script type="text/html" id="RMB2">
        {{d.psprice+'￥'}}
    </script>
    <script type="text/html" id="danger">
        {{#  if(d.warenum <= 50 ){ }}
        <span style="color: #eb3b5f;">{{ d.warenum }}</span>
        {{#  } else { }}
        {{ d.warenum }}
        {{#  } }}
    </script>
    <script type="text/html" id="addgoodsToolBar">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" type="button" lay-event="getCheckData">获取选中行数据</button>
            <button class="layui-btn layui-btn-sm" type="button" lay-event="getCheckLength">获取选中数目</button>
            <button class="layui-btn layui-btn-sm" type="button" lay-event="isAll">验证是否全选</button>
        </div>
    </script>
    <script type="text/html" id="xtableToolBar" >
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm layui-btn-radius layui-btn-danger"  type="button"  lay-event="del">
                <i class="layui-icon"></i>批量删除</button>
            <button class="layui-btn layui-btn-sm layui-btn-radius layui-btn-normal"
                       onclick="openAdd()">
                <i class="layui-icon"></i>添加计划商品</button>
        </div>

    </script>
    <script type="text/html" id="tax">
        {{# if(d.tax==null||d.tax=='') { }}
            {{0+'%'}}
        {{#  } else { }}
        {{d.tax+'%'}}
        {{#  } }}
</script>
    <script type="text/html" id="discount">
        {{# if(d.discount==null||d.discount=='') { }}
        {{# d.discount=0}}
        {{d.discount+'%'}}
        {{#  } else { }}
        {{d.discount+'%'}}
        {{#  } }}
    </script>
    <script type="text/html" id="count" title="">
<!--        {{#  layui.each(d.list, function(index, item){ }}-->
<!--            -->
<!--        {{#  }); }}-->

        {{# if(d.count==null||d.count=='') { }}
        {{1}}
        {{#  } else { }}
        {{d.count}}
        {{#  } }}
    </script>
    <script  type="text/html" id="total" title="">
        {{# if(d.count==null&&d.tax==null&&d.discount==null) { }}
        {{# if(d.psprice*1>=d.pbprice) { }}
        <span style="color: #77bf77;">{{d.psprice*1+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{d.psprice*1+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.tax==null&&d.discount==null){ }}
        {{# if(d.psprice*d.count>=d.pbprice*d.count) { }}
        <span style="color: #77bf77;">{{d.psprice*d.count+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{d.psprice*d.count+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.count==null&&d.discount==null){ }}
        {{# if(d.psprice+d.tax/100*(d.psprice)>=d.pbprice) { }}
        <span style="color: #77bf77;"> {{d.psprice+d.tax/100*(d.psprice)+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{d.psprice+d.tax/100*(d.psprice)+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.count==null&&d.tax==null){ }}
        {{# if(d.psprice-d.discount/100*(d.psprice)>=d.pbprice) { }}
        <span style="color: #77bf77;"> {{d.psprice-d.discount/100*(d.psprice)+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{d.psprice-d.discount/100*(d.psprice)+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.count==null){ }}
        {{# if((d.psprice*1+(d.tax/100*d.psprice-d.discount/100*d.psprice)*1)>=d.pbprice) { }}
        <span style="color: #77bf77;"> {{(d.psprice*1+(d.tax/100*d.psprice-d.discount/100*d.psprice)*1)+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{(d.psprice*1+(d.tax/100*d.psprice-d.discount/100*d.psprice)*1)+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.discount==null){ }}
        {{# if((d.psprice+d.tax/100*(d.psprice*d.count))*d.count>=d.pbprice*d.count) { }}
        <span style="color: #77bf77;"> {{(d.psprice+d.tax/100*(d.psprice*d.count))*d.count+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{(d.psprice+d.tax/100*(d.psprice*d.count))*d.count+'￥'}}</span>
        {{#  } }}
        {{#  } else if(d.tax==null){ }}
        {{# if((d.psprice*d.count-(d.discount/100*(d.psprice*d.count))*d.count)>=d.pbprice*d.count) { }}
        <span style="color: #77bf77;"> {{(d.psprice*d.count-(d.discount/100*(d.psprice*d.count))*d.count)+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;">{{(d.psprice*d.count-(d.discount/100*(d.psprice*d.count))*d.count)+'￥'}}</span>
        {{#  } }}
        {{#  } else { }}
        {{# if((d.psprice*d.count+(d.tax/100*d.psprice-d.discount/100*d.psprice)*d.count)>=d.pbprice*d.count) { }}
        <span style="color: #77bf77;"> {{(d.psprice*d.count+(d.tax/100*d.psprice-d.discount/100*d.psprice)*d.count)+'￥'}}</span>
        {{#  } else { }}
        <span style="color: #eb3b5f;"> {{(d.psprice*d.count+(d.tax/100*d.psprice-d.discount/100*d.psprice)*d.count)+'￥'}}</span>
        {{#  } }}
        {{#  } }}
    </script>
    <script name="InfiniteSelect">
        layui.config({
            base: 'module/',
            base2:'/'
        }).extend({
            selectN: 'selectNM/selectN',
            selectM: 'selectNM/selectM',
        }).use(['jquery','selectN','selectM','form','table'],function () {
            $ = layui.jquery;
            var selectN = layui.selectN
                ,selectM = layui.selectM;

            var form=layui.form;
            var table=layui.table;
            var kehudata=getkehu();
            //无限级分类-基本配置
            var catIns1 = selectN({
                //元素容器【必填】
                elem: '#kehuid'
                ,search:true
                //候选数据【必填】
                ,data:"category/selectAllWithKehu"
                ,last:true
                ,field:{idName:'cid',titleName:'name',childName:'children'}
            });

            // var catIns2 = selectN({
            //     //元素容器【必填】
            //     elem: '#kehuid2'
            //     ,search:true
            //     //候选数据【必填】
            //     ,data:"category/selectAllWithKehu"
            //     ,last:true
            //     ,field:{idName:'cid',titleName:'name',childName:'children'}
            // });
            form.on('submit(demo1)',function (data) {
                var arr=layui.table.cache["addgoods"];
                //    console.log(arr);
                //var selected=catIns1.selected; //lastName lastValue
                if (data.field.kehuid==''||data.field.kehuid==null){
                    layer.tips('请选择客户!', '#kehuid', {
                        tips: [4, '#16ccc1'],
                        time: 4000
                    });
                    return  false;
                }
                if (arr==null||arr==''){
                    layer.tips('商品不能为空的哦！！', '#addgoods', {
                        tips: [1, '#eb3b5f'],
                        time: 4000
                    });
                    return  false;
                }
                var formdata=data.field;
                var formdatas={
                    title:formdata.title,
                    pay:formdata.pay,
                    kehuid:formdata.kehuid
                };
                var val=new Array();
                console.log(val);
                $.ajax({
                    url:'saleandorder/addsal',
                    type:'get',
                    data:formdatas,
                    traditional:true,
                    success:function(res){
                        var data = res;
                        console.log(data);
                        if (data!="error"){
                            for (var i=0;i<arr.length;i++){
                                var address=arr[i].address[0].province+''+arr[i].address[0].city+''+arr[i].address[0].county+''+arr[i].address[0].title;
                                var values={rname:arr[i].pname,
                                    sprice:arr[i].psprice,
                                    stotal:arr[i].total,
                                    stax:arr[i].tax,
                                    sdiscount:arr[i].discount,
                                    paymethod:formdata.pay,
                                    remarks:arr[i].details,
                                    wid:arr[i].warehouse,
                                    address:address,
                                    scount:arr[i].count,
                                    ordernumber:data};
                                val.push(values);
                            }
                            $.ajax({
                                url:'saleandorder/addrel',
                                type:'post',
                                contentType: "application/json",
                                data:JSON.stringify(val),
                                traditional:true,
                                success:function(res){
                                    var data = res;
                                    console.log(data);
                                    if (data=="200"){
                                        layer.open({
                                            content: '添加成功！',
                                            icon:1,
                                            success: function(layero, index){
                                                table.reload("test");
                                            }
                                        });
                                    }else{
                                        layer.open({
                                            content: '商品货物添加失败！',
                                            icon:5,
                                            success: function(layero, index){
                                                table.reload("test");
                                            }
                                        });
                                    }
                                }
                            });

                        }else{
                            layer.open({
                                content: '添加失败',
                                icon:5,
                                success: function(layero, index){
                                    table.reload("test");
                                }
                            });
                        }

                      }

                });


                return false;
            });

        });


        function getkehu() {
            var alldata=null;
            $.ajax({
                url:"category/selectAllWithKehu",
                type:'get',
                success:function(res){
                    var data = res;
                    console.log(data);
                    // for(var i in data){
                    //     data[i].value = data[i].cid;
                    //     data[i].label = data[i].cType;
                    //     delete data[i].cid;
                    //     delete data[i].cType;
                    //     data[i].hasChild = true;
                    // }
                    alldata=data;
                }

            });
            return alldata;
        }

        function openAdd() {
            if (vm.$data.orderId!=null){
                layer.open({
                    type: 2,
                    closeBtn:2,
                    shadeClose:true,
                    title: "计划商品添加",

                    area: ['900px', '800px'],
                    anim: 2,
                    content: ['/SaleAndOrder-add.html'],
                    success: function (layero, index) {
                        var iframe = window['layui-layer-iframe' + index];//拿到iframe元素
                        iframe.child(vm.$data.orderId);
                        //iframe.child(JSON.stringify(data))//向此iframe层方法 传递参数
                    }
                });
            }else {
                layer.msg("请选择一个计划订单！");
            }
        }
        function openAdd2() {
            layer.open({
                type: 2,
                title: "计划订单添加",
                shade: 0.4,
                maxmin: true,
                area: ['1300px', '820px'],
                anim: 2,
                content: ['/SaleAndOrder-add2.html'],
                success: function (layero, index) {
                    var   iframe = window['layui-layer-iframe' + index];//拿到iframe元素
                    var cacheData=xx;
                    iframe.child(vm.$data.orderId,cacheData);
                    //iframe.child(JSON.stringify(data))//向此iframe层方法 传递参数
                }
            });
        }
        function sendData() {

            return xx;
        }
    </script>
    <script>layui.use('table',
        function() {
            var table = layui.table;
            //监听单元格编辑


            table.on('edit(test)',
                function(obj) {
                    var value = obj.value //得到修改后的值
                        ,
                        data = obj.data //得到所在行所有键值
                        ,
                        field = obj.field; //得到字段
                    layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
                });

            //监听行单击事件（双击事件为：rowDouble）
            table.on('row(test)', function(obj){
                var data = obj.data.ordernumber;
                vm.$data.orderId=data;
                vm.sendMessage();

                // layer.alert(JSON.stringify(data), {
                //     title: '当前行数据：'
                // });

                //标注选中样式
                obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
            });

            //头工具栏事件
            table.on('toolbar(test)',
                function(obj) {
                    var checkStatus = table.checkStatus(obj.config.id);
                    switch (obj.event) {
                        case 'getCheckData':
                            var data = checkStatus.data;
                            layer.alert(JSON.stringify(data));
                            break;
                        case 'getCheckLength':
                            var data = checkStatus.data;
                            layer.msg('选中了：' + data.length + ' 个');
                            break;
                        case 'isAll':
                            layer.msg(checkStatus.isAll ? '全选': '未全选');
                            break;
                        case 'delAny':
                            //var data=checkStatus.data[1].sid;
                            var sid=new Array();
                            var ordernumber=new Array();
                            if (checkStatus.data.length==0)return false;
                            for (var i=0;i<checkStatus.data.length;i++){
                                var data=checkStatus.data[i].sid;
                                var data2=checkStatus.data[i].ordernumber;
                                sid.push(data);
                                ordernumber.push(data2);
                            }
                            //var sid=JSON.stringify(sid);
                            $.ajax({
                                url:"saleandorder/del",
                                data:{sid:sid,ordernumber:ordernumber},
                                type:"post",
                                traditional:true,
                                success:function(data){
                                    if (data.code==0){
                                        layer.msg(data.result, {time: 5000, icon:6});
                                    }else{
                                        layer.msg(data.result, {time: 5000, icon:5});
                                    }

                                    //location.reload(); //删除成功后再刷新
                                },
                                error:function(data){
                                    layer.msg('錯誤！', {time: 5000, icon:6});
                                }
                            });
                            break;
                    };
                });
        });




    </script>
    <script>
        layui.use(['laydate', 'form'],function() {
            var laydate = layui.laydate;
            var  form = layui.form;
            $ = layui.$;



            //执行一个laydate实例
            laydate.render({
                elem: '#start' //指定元素
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });






        /*用户-停用*/
        function member_stop(obj, id) {
            layer.confirm('确认要停用吗？',
            function(index) {
                if ($(obj).attr('title') == '启用') {
                    //发异步把用户状态进行更改
                    $(obj).attr('title', '停用');
                    $(obj).find('i').html('&#xe62f;');
                    $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                    layer.msg('已停用!', {
                        icon: 5,
                        time: 1000
                    });
                } else {
                    $(obj).attr('title', '启用');
                    $(obj).find('i').html('&#xe601;');
                    $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                    layer.msg('已启用!', {
                        icon: 5,
                        time: 1000
                    });
                }

            });
        }

        /*用户-删除*/
        function member_del(obj, id) {
            layer.confirm('确认要删除吗？',
            function(index) {
                //发异步删除数据
                $(obj).parents("tr").remove();
                layer.msg('已删除!', {
                    icon: 1,
                    time: 1000
                });
            });
        }

        });
      </script>
    <script>
        layui.use(['layer', 'layarea'], function() {
            var layer = layui.layer,
                layarea = layui.layarea;

            layarea.render({
                elem: '#area-picker',
                data: {
                    province: '湖南省',
                    city: '长沙市',
                    county: '岳麓区',
                },
                change: function (res) {
                    //选择结果
                    console.log(res);
                }
            });
        })
    </script>
    <script type="text/html" id="toolbarDemo">
        <div class = "layui-btn-container" >
            <button 	class="layui-btn layui-btn-sm layui-btn-radius layui-btn-danger" lay-event="delAny"> <i class="layui-icon"></i>批量删除</button></button>
<!--            <button 	class="layui-btn layui-btn-sm layui-btn-radius layui-btn-normal" lay-event = "getCheckData" >添加计划订单</button>-->
<!--            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" > 获取选中行数据 </button>-->
<!--            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button >-->
<!--            <button class = "layui-btn layui-btn-sm" lay-event = "isAll" > 验证是否全选</button>-->
        </div >
    </script>
    <script type="text/html" id="xtableBar">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
    <script  name="VUE-VM">
        var doneTest=function () {
            $("th").css({'font-size':'14','color':'black','border-color':'#aaa'});
            $("td").css({"border-color":'#aaa'});
        };
        var vm=new Vue({
            el:"#xx",
            data:{list:[], list2:[], orderId:null, pageNum:1, pageSize:10, count:null},
            methods:{
                sendMessage(){
                    var data=  Qs.stringify({"ordernumber":this.orderId,"pageNum":this.pageNum,"pageSize":this.pageSize});
                    axios.post('relatedsaleandorder/queryAll',data, {headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(res=>{
                        this.list=res.data.data;
                        this.count=res.data.count;
                        var xtabledata=res.data;
                        console.log(xtabledata);
                        var count=this.count;
                        if (res.data!=null){
                            layui.use(['laypage','table','jquery'], function(){
                                var laypage = layui.laypage;
                                var table=layui.table;
                                var $=layui.jquery;
                                //执行一个laypage实例
                                laypage.render({
                                    elem: 'page1' //注意，这里的 test1 是 ID，不用加 # 号
                                    ,count: vm.$data.count//数据总数，从服务端得到
                                    ,limit:10
                                    ,limits:[10,15,20,40]
                                    ,theme: '#1E9FFF'
                                    ,layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                                    ,curr: location.hash.replace('#!fenye=', '') //获取hash值为fenye的当前页
                                    ,hash: 'fenye' //自定义hash值
                                    ,jump: function(obj, first){
                                        //obj包含了当前分页的所有参数，比如
                                        //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                                        //得到每页显示的条数
                                        //首次不执行
                                        if(!first){
                                            console.log(obj.limit);
                                            $.ajax({
                                                url:"relatedsaleandorder/queryAll",
                                                data:{"ordernumber":vm.$data.orderId,"pageNum":obj.curr,"pageSize":obj.limit},
                                                type:"post",
                                                async: false,
                                                traditional:true,
                                                success:function(data) {
                                                    //layer.msg(data);
                                                    vm.$data.list = data.data;
                                                    vm.$data.count = data.count;
                                                    table.reload('xtable', {
                                                        data: data.data
                                                        //location.reload(); //删除成功后再刷新
                                                    });
                                                },
                                                error:function(data){
                                                }
                                            });
                                        }
                                    }
                                });

                                var xtable=table.render({
                                    elem: '#xtable'
                                    ,data:res.data.data
                                    ,toolbar:'#xtableToolBar'
                                    ,defaultToolbar: ['exports', 'print']
                                    ,cols: [[
                                        {type:'checkbox',field:'pid',fixed: 'left',rowspan:3}
                                        ,{field:"rname",title: '商品名',rowspan:3,width:210}
                                        ,{title:'商品信息',colspan:7,align:"center"}
                                        ,{title:'其他',colspan:2,align:"center"}
                                        ,{title:'操作',rowspan:3,toolbar: '#xtableBar',width:149}
                                    ],[
                                        {field:'scount',title:"数量",rowspan:2,width:110}
                                        ,{field:"sunit",title:"单位",rowspan:2,align:"center",width:110}
                                        ,{title:"详细",colspan:5,align:"center"}
                                        ,{field:"paymethod",title:"支付方式",rowspan:2,width:120}
                                        ,{field:"address",title:"收货地址",rowspan:2,width:224}
                                    ],[
                                        {field:"sprice",title:"商品价格",rowspan:2,width:110}
                                        ,{field:"sdiscount",title:"折扣",width:110}
                                        ,{field:"stax",title:"税率",width:110}
                                        ,{field:"stotal",title:"折税价",width:164}
                                        ,{field:"remarks",title:"备注",width:140}
                                    ]]
                                    ,done:function (res) {
                                        $("th").css({'font-size':'14','color':'black','border-color':'#aaa'});
                                        $("td").css({"border-color":'#aaa'});

                                    }
                                });

                                table.on('toolbar(xtable)', function(obj){
                                    var checkStatus = table.checkStatus(obj.config.id);
                                    switch(obj.event){
                                        case 'del':
                                            var data = checkStatus.data;
                                            //var data=checkStatus.data[1].sid;
                                            var sid=new Array();
                                            var ordernumber=new Array();
                                            if (checkStatus.data.length==0)return false;
                                            for (var i=0;i<checkStatus.data.length;i++){
                                                var data=checkStatus.data[i].sid;
                                                var data2=checkStatus.data[i].ordernumber;
                                                sid.push(data);
                                                ordernumber.push(data2);
                                            }
                                            //var sid=JSON.stringify(sid);
                                            $.ajax({
                                                url:"relatedsaleandorder/del",
                                                data:{sid:sid,ordernumber:ordernumber},
                                                type:"post",
                                                traditional:true,
                                                success:function(data){
                                                    if (data.code==0){
                                                        layer.msg(data.result, {time: 5000, icon:6});

                                                    }else{
                                                        layer.msg(data.result, {time: 5000, icon:5});
                                                    }

                                                    //location.reload(); //删除成功后再刷新
                                                },
                                                error:function(data){
                                                    layer.msg('錯誤！', {time: 5000, icon:6});
                                                }

                                            });
                                            table.reload('xtable');
                                            break;
                                        case 'getCheckLength':
                                            var data = checkStatus.data;
                                            layer.msg('选中了：'+ data.length + ' 个');
                                            break;
                                        case 'isAll':
                                            layer.msg(checkStatus.isAll ? '全选': '未全选');
                                            break;
                                        //自定义头工具栏右侧图标 - 提示
                                        case 'LAYTABLE_TIPS':
                                            layer.alert('这是工具栏右侧自定义的一个图标按钮');
                                            break;
                                    };
                                });

                                //监听行工具事件
                                table.on('tool(xtable)', function(obj){
                                    var data = obj.data;
                                    //console.log(obj)
                                    if(obj.event === 'del'){
                                        layer.confirm('真的删除行么', function(index){
                                            obj.del();
                                            layer.close(index);
                                        });
                                    } else if(obj.event === 'edit'){
                                        layer.prompt({
                                            formType: 2
                                            ,value: data.email
                                        }, function(value, index){
                                            obj.update({
                                                email: value
                                            });
                                            layer.close(index);
                                        });
                                    }
                                });

                            });
                        }



                    }).catch(err=>{
                        console.log(err);
                        alert('请求失败')
                    })
                }
            },
            mounted(){

            },
            created(){

            },
            beforeUpdate:function(){

            },
            updated:function() {

                layui.use('laypage', function(){
                    var laypage = layui.laypage;
                    laypage.render();
                });
                layui.use('form', function () {
                    var form = layui.form;
                    form.render();
                });
                layui.use('table', function () {
                    var table = layui.table;
                    table.render();
                    table.reload();
                });
            },
            filters: {
                RMB: function (value) {
                    return value + '￥';
                }
            }
        });
    </script>
    <script name="VUE-V1">
        var v1=new Vue({
            el:"#v1",
            data:{
                list:[],
            },
            mounted(){
            },
            methods:{
                // axios.post('relatedsaleandorder/queryAll',data, {headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(res=>{
            }
        });
    </script>


    <script name="addGoods">
        var xx=new Array();
        function GetValue(obj,datafiled,ids) {
            var datafiled=JSON.stringify(datafiled);
            var leng=xx.length;
            for (var i=0;i<obj.length;i++){
                var obj1=JSON.stringify(obj[i]);
                var obj2=JSON.parse(obj1.substr(0,obj1.length-1)+",\"address\"" +":"+'['+datafiled+']'+"}");
                xx.push(obj2);
            }
            // console.log(xx);
            layui.use(['table','jquery'],function(){
                var table = layui.table;
                //第一个实例
                var $=layui.jquery;
                table.render('test',{

                    done:function(res) {
                        $("th").css({'font-size':'14','color':'black','border-color':'#aaa'});
                        $("td").css({"border-color":'#aaa'});
                    }});
                var addgoods=table.render({
                    elem: '#addgoods'
                    ,data: xx
                    ,page: true //开启分页
                    ,limits:[1000,2000,3000]
                    ,limit:1000
                    ,toolbar:'#addgoodsToolBar'
                    ,cols: [[
                        {type:'checkbox',field:'pid',fixed: 'left'}
                        ,{field:'id',type:'numbers',width:90, title: 'ID', sort: true}
                        ,{field:'count',type:'normal',title:'数量',edit:true,templet:'#count'}
                        ,{field:'tax',title:'税率',edit:true,templet:'#tax'}
                        ,{field:'discount',title:'折扣',edit:true,templet:'#discount'}
                        ,{field:'total',title:'折税价',templet:'#total'}
                        ,{field:'pname', width:120, title: '商品名'}
                        ,{field:'ptype',width:120,title:'商品类型', sort: true,templet:'#producttype'}
                        ,{field:'pbprice', width:90, title: '商品进价',templet:'#RMB1'}
                        ,{field:'psprice', width:90,title: '商品售价',templet:'#RMB2'}
                        ,{type:'normal',title:'配送地址',templet:function(d){return d.address[0].province+""+d.address[0].city+""+d.address[0].county+""+d.address[0].title;}}
                        ,{field:'warehouse', width:120, title: '所在仓库', sort: true,templet:'#warehouse'}
                        ,{field:'warenum', width:90, title: '库存数量', sort: true,templet:'#danger'}
                        ,{field:'details', title: '说明',fixed:'right'}
                    ]]
                    ,done:function(res, curr, count){
                        $("th").css({'font-size':'14','color':'black','border-color':'#aaa'});
                        $("td").css({"border-color":'#aaa'});
                        console.log(res);
                        //得到数据总量
                        console.log(count);
                    }
                });

                Array.prototype.remove=function(dx) {
                    if(isNaN(dx)||dx>this.length){return false;}
                    for(var i=0,n=0;i<this.length;i++)
                    {
                        if(this[i]!=this[dx])
                        {
                            this[n++]=this[i]
                        }
                    }
                    this.length-=1
                }

                //头工具栏事件
                table.on('toolbar(addgoods)', function(obj){
                    var checkStatus = table.checkStatus(obj.config.id);
                    switch(obj.event){
                        case 'getCheckData':
                            var data = checkStatus.data;
                            for(var i=0;i<xx.length;i++){
                                for (var j=0;j<data.length;j++){
                                    if (xx[i].pid==data[j].pid){
                                        console.log(data[j].pid);
                                        xx.remove(i);
                                    }
                                }
                            }
                            addgoods.reload( {
                                data:xx
                            });
                            layer.msg('选中了：'+ data.length + ' 个');
                            break;
                        case 'isAll':
                            layer.msg(checkStatus.isAll ? '全选': '未全选');
                            break;

                        //自定义头工具栏右侧图标 - 提示
                        case 'LAYTABLE_TIPS':
                            layer.alert('这是工具栏右侧自定义的一个图标按钮');
                            break;
                    };
                });

                var oldcount=null;

                //监听行工具事件
                table.on('tool(addgoods)', function(obj){
                    var data = obj.data;
                    console.log(data)
                    oldcount=data.count
                    if(obj.event === 'del'){
                        layer.confirm('真的删除行么', function(index){
                            obj.del();
                            layer.close(index);
                        });
                    } else if(obj.event === 'edit'){
                        layer.prompt({
                            formType: 2
                            ,value: data.email
                        }, function(value, index){
                            obj.update({
                                email: value
                            });
                            layer.close(index);
                        });
                    }
                });
                /**
                 * 强制保留2位小数，不足补 0
                 */
                function toDecimal(x) {
                    var f = parseFloat(x);
                    if (isNaN(f)) {
                        return false;
                    }
                    var f = Math.round(x*100)/100;
                    var s = f.toString();
                    var rs = s.indexOf('.');
                    if (rs < 0) {
                        rs = s.length;
                        s += '.';
                    }
                    while (s.length <= rs + 2) {
                        s += '0';
                    }
                    return s;
                }
                //监听单元格编辑
                table.on('edit(addgoods)', function(obj){
                    var value = obj.value //得到修改后的值
                        ,data = obj.data //得到所在行所有键值
                        ,field = obj.field; //得到字段
                    if (!(/(^[1-9]\d*$)/.test(value))) {
                        if (field == 'count') {
                            obj.update({
                                count: 1
                            });
                            addgoods.reload();
                            return false;
                        }
                    }
                    if (field=="count"){
                        var count=0;
                        var total=0;
                        var Differencevalue=0;
                        var val=layui.table.cache["addgoods"];
                        console.log(val);
                        for (var i=0;i<val.length;i++){

                            if (val[i].pid==data.pid&&val[i].warehouse==data.warehouse){
                                console.log(val[i].pid);
                                console.log(data.pid);
                                count++;
                                console.log(count);
                                //判断是否有重复的，有就去判断 疯了！！
                                if (count>0){
                                    if (val[i].count==null||val[i].count==''){
                                        total+=1;
                                    }else{
                                        total+=val[i].count*1;
                                    }
                                }
                            }



                            //说明数量多了 我自己看不懂了 啊啊啊啊啊啊啊啊啊！
                            if (val[i].count!=value&&val[i].warehouse==data.warehouse&&val[i].pid==data.pid){
                                if (val[i].count==null||val[i].count==''){
                                    Differencevalue+=1;
                                }else{
                                    Differencevalue+=val[i].count*1;
                                }
                            }
                        }
                         console.log("差值"+Differencevalue);
                        if(total>data.warenum){
                            var count = data.warenum-Differencevalue;
                            obj.update({
                                count:count
                            });
                        }

                    }


                    addgoods.reload();
                });

            });

        }
    </script>
    <script>
    // 自定义模块，这里只需要开放soulTable即可
    layui.config({
        base: 'module/',   // 第三方模块所在目录
        version: 'v1.5.10' // 插件版本号
    }).extend({
        soulTable: 'soulTable/soulTable',
        tableChild: 'soulTable/tableChild',
        tableMerge: 'soulTable/tableMerge',
        tableFilter: 'soulTable/tableFilter',
        excel: 'soulTable/excel',
    }).use(['form', 'table','soulTable','laydate'], function () {
        var table = layui.table,
            soulTable = layui.soulTable
            laydate=layui.laydate
            form=layui.form;
        var soultable=table.render({
            elem: '#soultable'
            ,url: 'saleandorder/selectAll'
            ,method:'get'
            ,height:'880px'
            ,toolbar: '<div><button class="layui-btn layui-btn-sm  layui-btn-normal" lay-event="clearFilter">清除所有筛选条件</button>' +
                '<button class="layui-btn layui-btn-sm  layui-btn-danger" lay-event="delAll">批量删除</button></div>'
            ,page: true
            //,dataType:'json'
            // ,soulSort: false
            ,limit:10
            ,limits: [10,20,30,40]
            ,overflow: 'tips'
            ,contextmenu: {
                // 表头右键菜单配置
                header: [
                    {
                        name: '复制',
                        icon: 'layui-icon layui-icon-template',
                        click: function(obj) {
                            soulTable.copy(obj.text)
                            layer.msg('复制成功！')
                        }
                    },
                    {
                        name: '导出excel',
                        click: function() {
                            soulTable.export(this.id)
                        }
                    },
                    {
                        name: '重载表格',
                        icon: 'layui-icon layui-icon-refresh-1',
                        click: function() {
                            table.reload(this.id)
                        }
                    },
                    {
                        name: '刷新页面',
                        icon: 'layui-icon layui-icon-refresh-1',
                        click: function() {
                            location.reload();
                        }
                    },
                    {
                        name: '字体颜色',
                        icon: 'layui-icon layui-icon-theme',
                        children: [
                            {
                                name: '红色',
                                click: function(obj) {
                                    obj.elem.css('color', 'red')
                                }
                            },
                            {
                                name: '绿色',
                                click: function(obj) {
                                    obj.elem.css('color', '#009688')
                                }
                            },
                            {
                                name:'默认颜色',
                                click:function (obj) {
                                    obj.elem.css('color','')
                                }
                            }

                        ]
                    }
                    ,
                    {
                        name: '背景色',
                        icon: 'layui-icon layui-icon-theme',
                        children: [
                            {
                                name: '红色',
                                click: function(obj) {
                                    obj.elem.css('background', '#eb6775')
                                }
                            },
                            {
                                name: '绿色',
                                click: function(obj) {
                                    obj.elem.css('background', '#77bf77')
                                }
                            },
                            {
                                name: '默认颜色',
                                click: function(obj) {
                                    obj.elem.css('background', '')
                                }
                            }
                        ]
                    }
                ],
                // 表格内容右键菜单配置
                body: [
                    {
                        name: '复制',
                        icon: 'layui-icon layui-icon-template',
                        click: function(obj) {
                            soulTable.copy(obj.text)
                            layer.msg('复制成功！')
                        }
                    },
                    {
                        name: '删除当前行数据',
                        click: function(obj) {
                            console.log(obj.row.ordernumber);
                            console.log(obj.row.sid);
                            var sid=new Array();
                            var ordernumber=new Array();
                            sid.push(obj.row.sid);
                            ordernumber.push(obj.row.ordernumber);
                            //var sid=JSON.stringify(sid);
                            $.ajax({
                                url:"saleandorder/del",
                                data:{sid:sid,ordernumber:ordernumber},
                                type:"post",
                                traditional:true,
                                success:function(data){
                                    if (data.code==0){
                                        layer.msg(data.result, {time: 5000, icon:6});
                                    }else{
                                        layer.msg(data.result, {time: 5000, icon:5});
                                    }

                                    //location.reload(); //删除成功后再刷新
                                },
                                error:function(data){
                                    layer.msg('錯誤！', {time: 5000, icon:6});
                                }
                            });
                            obj.del();
                        }
                    },
                    {
                        name: '更新数据',
                        click: function(obj) {
                            obj.update({author: obj.row.author + '+1'})
                        }
                    },
                    {
                        name: '行',
                        children: [
                            {
                                name: '红色',
                                click: function(obj) {
                                    obj.trElem.css('background', 'red')
                                }
                            },
                            {
                                name: '绿色',
                                click: function(obj) {
                                    obj.trElem.css('background', '#77bf77')
                                }
                            },
                            {
                                name:'默认颜色',
                                click:function (obj) {
                                    obj.trElem.css('background','')
                                }
                            }

                        ]

                    },
                    {
                        name:'单元格',
                        children:[
                            {
                                name: '红色',
                                click: function(obj) {
                                    obj.elem.css('color', 'red')
                                }
                            },
                            {
                                name: '绿色',
                                click: function(obj) {
                                    obj.elem.css('color', '#77bf77')
                                }
                            },
                            {
                                name: '黑色',
                                click: function(obj) {
                                    obj.elem.css('color', '')
                                }
                            }
                        ]
                    }
                ],
                // 合计栏右键菜单配置
                total: [
                    {
                        name: '背景黄色',
                        click: function(obj) {
                            obj.elem.css('background', '#FFB800')
                        }
                    },
                    {
                        name: '背景红色',
                        click: function(obj) {
                            obj.elem.css('background', '#eb3b5f')
                        }
                    }
                ]
            }
            ,cols: [[
                {title: '详细信息', width: 50, collapse: true,  children: function(row) {
                        return [
                            {
                                 title:'<span style="color: #ff60ef">'+ row.customername + '</span><span style="color: #ff5722">客户的</span><span style="color: #FFB800" >详细计划订单</span></span><span style="color: #77bf77">' + row.ordernumber + '</span>'
                                ,url:'relatedsaleandorder/queryAll'
                                ,height: 650
                                ,page: true
                                ,overflow: 'tips'
                                ,toolbar: '<div><a class="layui-btn layui-btn-sm" lay-event="reload">刷新子表</a> <a class="layui-btn layui-btn-normal layui-btn-sm" lay-event="update">更新父表</a> <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="delete">删除计划订单当前行</a> <a class="layui-btn layui-btn-sm layui-btn-warm" lay-event="close">关闭子表</a></div>'
                                ,cols: [[
                                    {type:'checkbox',field:'pid',fixed: 'left',rowspan:3}
                                    ,{field:"rname",title: '商品名',rowspan:3,width:210}
                                    ,{title:'商品信息',colspan:7,align:"center"}
                                    ,{title:'其他',colspan:2,align:"center"}
                                    ,{title:'操作',rowspan:3,toolbar: '#xtableBar',width:149}
                                ],[
                                    {field:'scount',title:"数量",rowspan:2,width:110}
                                    ,{field:"sunit",title:"单位",rowspan:2,align:"center",width:110}
                                    ,{title:"详细",colspan:5,align:"center"}
                                    ,{field:"paymethod",title:"支付方式",rowspan:2,width:120}
                                    ,{field:"address",title:"收货地址",rowspan:2,width:224}
                                ],[
                                    {field:"sprice",title:"商品价格",rowspan:2,width:110}
                                    ,{field:"sdiscount",title:"折扣",width:110}
                                    ,{field:"stax",title:"税率",width:110}
                                    ,{field:"stotal",title:"折税价",width:130}
                                    ,{field:"remarks",title:"备注",width:120}
                                ]]
                                ,rowEvent: function (obj, pobj) {
                                    // 单击行事件
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象
                                    obj.tr.css({'background':'#5FB878'}).siblings().removeAttr('style')
                                    console.log(obj.tr) //得到当前行元素对象
                                    console.log(obj.data) //得到当前行数据
                                    console.log(pobj) //得到当前行数据
                                    //obj.del(); //删除当前行
                                    //obj.update(fields) //修改当前行数据
                                }
                                ,rowDoubleEvent: function (obj, pobj) {
                                    // 双击行事件
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象
                                    //obj.tr.css({'background':'#FF5722'}).siblings().removeAttr('style')
                                    console.log(obj.tr) //得到当前行元素对象
                                    console.log(obj.data) //得到当前行数据
                                    //obj.del(); //删除当前行
                                    //obj.update(fields) //修改当前行数据
                                }
                                ,toolEvent: function (obj, pobj) {
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象

                                    var childId = this.id; // 通过 this 对象获取当前子表的id

                                    if (obj.event === 'childEdit') {
                                        layer.confirm('修改成功！调用<span style="color: #FF5722">行对象</span>修改当前行数据', {icon: 3}, function(index) {
                                            layer.close(index);
                                            obj.update({
                                                title: '我被修改了！'
                                            });
                                        });
                                    } else if (obj.event === 'del') {
                                        layer.confirm('删除成功! 调用<span style="color: #FF5722">table.reload(childId)</span>来重载子表', {icon: 3}, function(index) {

                                            layer.close(index);
                                            table.reload(childId);
                                        })
                                    }
                                }
                                ,toolbarEvent: function (obj, pobj) {
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象
                                    if (obj.event === 'reload') {
                                        table.reload(this.id);
                                        layer.msg('子表重载成功！')
                                    } else if (obj.event === 'delete') {
                                        console.log(pobj);
                                        var sid=new Array();
                                        var ordernumber=new Array();
                                        sid.push(pobj.data.sid);
                                        ordernumber.push(pobj.data.ordernumber);
                                        console.log(sid);
                                        console.log(ordernumber);
                                        //var sid=JSON.stringify(sid);
                                        $.ajax({
                                            url:"saleandorder/del",
                                            data:{sid:sid,ordernumber:ordernumber},
                                            type:"post",
                                            traditional:true,
                                            success:function(data){
                                                if (data.code==0){
                                                    layer.msg(data.result, {time: 5000, icon:6});
                                                }else{
                                                    layer.msg(data.result, {time: 5000, icon:5});
                                                }

                                                //location.reload(); //删除成功后再刷新
                                            },
                                            error:function(data){
                                                layer.msg('錯誤！', {time: 5000, icon:6});
                                            }
                                        });
                                        pobj.del();
                                    } else if (obj.event === 'update') {
                                        pobj.update({dynasty: pobj.data.dynasty + '+1'})
                                    } else if (obj.event === 'close') {
                                        pobj.close()
                                    }
                                }
                                ,checkboxEvent: function(obj, pobj) {
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象
                                    layer.msg('子表checkb ox事件，当前是否选中：' + obj.checked)
                                }
                                ,editEvent: function(obj, pobj) {
                                    // obj 子表当前行对象
                                    // pobj 父表当前行对象
                                    layer.msg(obj.oldValue + " 已成功改为：" + obj.value);
                                }
                                ,where:{
                                    ordernumber:row.ordernumber
                                }

                                ,done: function () {
                                   soulTable.render(this)
                                }

                            }

                        ]
                    }},
                {type:'checkbox',field:'pid'},
                {field: 'ordernumber', title: '计划订单编号', width: 160, sort: true, filter: true},
                {field: 'ordernumber2', title: '关联订单编号', width: 160, sort: true, filter: true},
                {field: 'customername', title: '收货人', width: 165, filter: true},
                {field: 'stotal', title: '总金额', width: 120, filter: true,sort:true},
                {field: 'status', title: '订单状态', width: 110, sort:true},
                {field: 'sdate', title: '下单时间', width: 180, sort:true},
                {field: 'rdate', title: '交货日期', width: 180, sort:true},
                {field: 'author', title: '制单人', width: 110, filter: true},
                {field: 'inspect', title: '审核人', width: 110, filter: true},
                {field: 'remarks', title: '备注', width: 180}

            ]]
            ,rowEvent: function (obj) {
                // layer.msg('父表行单击行事件！并展开子表！')
                // obj.tr.css({'background':'#5FB878','color':'white'}).siblings().removeAttr('style') // 设置当前行颜色
                console.log(obj.tr) //得到当前行元素对象
                console.log(obj.data) //得到当前行数据
                obj.tr.find('.childTable').trigger('click'); // 触发展开/关闭当前行子表
                //obj.del(); //删除当前行
                //obj.update(fields) //修改当前行数据
            }
            ,filter: {
                items:['column','data','condition','editCondition','excel','clearCache'] // 加入了清除缓存按钮
                ,cache: true
            }

            ,done: function () {
                soulTable.render(this)
            }

        });
        //工具栏
        table.on('toolbar(soultable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            if (obj.event === 'clearFilter') {
                // 清除所有筛选条件并重载表格
                // 参数: tableId

                soulTable.clearFilter('soultable')
            }else if(obj.event === 'delAll'){
                var data = checkStatus.data;
                layer.msg('选中了：'+ data.length + ' 个');
                console.log(data);
                var sid=new Array();
                var ordernumber=new Array();
                if (checkStatus.data.length==0)return false;
                for (var i=0;i<checkStatus.data.length;i++){
                    var data=checkStatus.data[i].sid;
                    var data2=checkStatus.data[i].ordernumber;
                    sid.push(data);
                    ordernumber.push(data2);
                }
                //var sid=JSON.stringify(sid);
                $.ajax({
                    url:"saleandorder/del",
                    data:{sid:sid,ordernumber:ordernumber},
                    type:"post",
                    traditional:true,
                    success:function(data){
                        if (data.code==0){
                            layer.msg(data.result, {time: 5000, icon:6});
                        }else{
                            layer.msg(data.result, {time: 5000, icon:5});
                        }

                        //location.reload(); //删除成功后再刷新
                    },
                    error:function(data){
                        layer.msg('錯誤！', {time: 5000, icon:6});
                    }
                });
                table.reload('soultable');
            }else{

            }
        });

        //修改
        table.on('edit(soultable)',function (obj) {
            var value = obj.value //得到修改后的值
                ,data = obj.data //得到所在行所有键值
                ,field = obj.field; //得到字段
            layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);

        });
        //时间
        laydate.render({
            elem: '[name=createTime]',
            range: true
        });

        // 查询
        form.on('submit(search)', function (data) {
            console.log(data.field);
            if (data.field.createTime!=null) {
                data.field.startTime = data.field.createTime.split(' - ')[0];
                data.field.endTime = data.field.createTime.split(' - ')[1];
            }else{
                delete data.field.endTime
                delete data.field.startTime
                delete data.field.createTime
            }
            console.log(data.field);



            soultable.reload({  // 重载 table
                where: data.field
            });
            return false;
        });


    });


</script>


</html>
